<ion-content class="ion-padding">
  <!-- Header -->
  <ion-grid class="max-w-6xl mx-auto">
    <ion-row class="mb-4">
      <ion-col>
        <h2 class="text-2xl font-semibold">TruckTurn Dashboard</h2>
        <p class="text-sm text-gray-600">
          Manage driver check-ins and rotations
        </p>
      </ion-col>
    </ion-row>

    <!-- Stats -->
    <ion-row class="mb-2 -mx-1">
      <ion-col size="6" size-md="3" class="px-1 mb-2">
        <ion-card class="rounded-xl shadow-md m-0">
          <ion-card-content class="p-3">
            <h3 class="flex justify-center items-center gap-1 text-green-600">
              <span class="text-xl">üë•</span>
              <span class="text-2xl font-extrabold">
                {{ driverStatusDetails?.totalDrivers }}
              </span>
            </h3>
            <p class="text-base font-medium text-gray-700 mt-1 text-center">
              Total Drivers
            </p>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="6" size-md="3" class="px-1 mb-2">
        <ion-card class="rounded-xl shadow-md m-0">
          <ion-card-content class="p-3">
            <h3 class="flex justify-center items-center gap-1 text-green-600">
              <span class="text-xl">‚úîÔ∏è</span>
              <span class="text-2xl font-extrabold">
                {{ driverStatusDetails?.availableCount }}
              </span>
            </h3>
            <p class="text-base font-medium text-gray-700 mt-1 text-center">
              Available
            </p>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="6" size-md="3" class="px-1 mb-2">
        <ion-card class="rounded-xl shadow-md m-0">
          <ion-card-content class="p-3">
            <h3 class="flex justify-center items-center gap-1 text-green-600">
              <span class="text-xl">üìÖ</span>
              <span class="text-2xl font-extrabold">
                {{ driverStatusDetails?.checkedInCount }}
              </span>
            </h3>
            <p class="text-base font-medium text-gray-700 mt-1 text-center">
              Checked In
            </p>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="6" size-md="3" class="px-1 mb-2">
        <ion-card class="rounded-xl shadow-md m-0">
          <ion-card-content class="p-3">
            <h3 class="flex justify-center items-center gap-1 text-green-600">
              <span class="text-xl">üïí</span>
              <span class="text-2xl font-extrabold">
                {{ driverStatusDetails?.totalRounds }}
              </span>
            </h3>
            <p class="text-base font-medium text-gray-700 mt-1 text-center">
              Rounds Completed
            </p>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>

    <!-- Check-in Control Accordion -->
    <ion-card class="rounded-xl shadow-md">
      <ion-card-content class="p-0">
        <ion-accordion-group value="checkin-control">
          <ion-accordion value="checkin-control">
            <ion-item
              slot="header"
              button
              (click)="checkinAccordionOpen = !checkinAccordionOpen"
            >
              <ion-card-title class="text-lg font-semibold text-gray-800">
                Check-in Control
              </ion-card-title>
            </ion-item>

            <ion-list slot="content" class="ion-padding space-y-2">
              <!-- Start New Round Button -->
              <ion-button
                expand="block"
                fill="solid"
                [disabled]="!enableCompleteRoundButton"
                [style.--background]="enableCompleteRoundButton ? '#166534' : '#a4a6a5'"
                [style.--color]="enableCompleteRoundButton ? 'white' : 'black'"
                (click)="startNewRound()"
              >
                Start New Check-in Round
              </ion-button>

              <!-- Complete Current Round Button -->
              <ion-button
                expand="block"
                fill="solid"
                [disabled]="!disableNewRoundButton"
                [style.--background]="disableNewRoundButton ? '#0d416b' : '#a4a6a5'"
                [style.--color]="disableNewRoundButton ? 'white' : 'black'"
                (click)="completeCurrentRound()"
              >
                Complete Current Round
              </ion-button>
            </ion-list>
          </ion-accordion>
        </ion-accordion-group>
      </ion-card-content>
    </ion-card>

    <ion-card class="rounded-xl shadow-md border border-gray-300">
      <!-- Tabs -->
      <ion-card-content class="p-4">
        <ion-segment [(ngModel)]="activeTab">
          <ion-segment-button class="text-green-600" value="available">
            Available
          </ion-segment-button>
          <ion-segment-button class="text-orange-600" value="checkedIn">
            Checked-In
          </ion-segment-button>
          <ion-segment-button class="text-blue-600" value="completed">
            Rounds
          </ion-segment-button>
        </ion-segment>

        <!-- Available Tab -->
        <ng-container *ngIf="activeTab === 'available'">
          <div class="bg-green-50 border mt-4 rounded-xl p-4">
            <h2 class="text-green-800 text-lg font-semibold mb-4">
              Available Drivers ({{ availableDriversList.length }})
            </h2>
            <ng-container *ngIf="availableDriversList.length; else noAvailable">
              <ion-list>
                <ion-item *ngFor="let d of availableDriversList">
                  <ion-label class="ion-text-wrap">
                    <h3>{{ d.driverName.toUpperCase() }}</h3>
                    <p><b>Owner Name:</b> {{ d.ownerName }}</p>
                    <p><b>Phone:</b> {{ d.phoneNumber }}</p>
                    <p><b>Vehicle Number:</b> {{ d.vehicleNumber ?? '-' }}</p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </ng-container>
            <ng-template #noAvailable>
              <p class="text-center">No available drivers</p>
            </ng-template>
          </div>
        </ng-container>

        <!-- Checked-In Tab -->
        <ng-container *ngIf="activeTab === 'checkedIn'">
          <div class="bg-orange-50 border mt-4 rounded-xl p-4">
            <h2 class="text-orange-800 text-lg font-semibold mb-4">
              Available Drivers ({{ availableDriversList.length }})
            </h2>
            <ng-container *ngIf="checkedInDriversList.length; else noCheckedIn">
              <ion-list>
                <ion-item *ngFor="let d of checkedInDriversList">
                  <ion-label class="ion-text-wrap">
                    <h3>{{ d.driverName.toUpperCase() }}</h3>
                    <p><b>Owner Name:</b> {{ d.ownerName }}</p>
                    <p><b>Phone:</b> {{ d.phoneNumber }}</p>
                    <p><b>Vehicle Number:</b> {{ d.vehicleNumber ?? '-' }}</p>
                    <p><b>Drop Location:</b> {{ d.dropLocation }}</p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </ng-container>
            <ng-template #noCheckedIn>
              <p class="text-center">No checked-in drivers</p>
            </ng-template>
          </div>
        </ng-container>

        <!-- Completed Tab -->
        <ng-container *ngIf="activeTab === 'completed'">
          <div class="bg-blue-50 border mt-4 rounded-xl p-4">
            <h2 class="text-blue-800 text-lg font-semibold mb-4">
              Completed Rounds ({{ roundsCompletedList.length }})
            </h2>
            <ng-container *ngIf="roundsCompletedList.length; else noCompleted">
              <div class="space-y-2">
                <ion-button
                  *ngFor="let d of roundsCompletedList"
                  expand="block"
                  [style.--background]=" '#166534'"
                  [style.--color]="'white'"
                  (click)="openRoundDetails(d)"
                >
                  {{ d.round ? 'Round ' + d.round : d }} Completed
                </ion-button>
              </div>
            </ng-container>
            <ng-template #noCompleted>
              <p class="text-center">No completed drivers</p>
            </ng-template>
          </div>
        </ng-container>
      </ion-card-content>
    </ion-card>
  </ion-grid>
</ion-content>
